# Ресемплинг на основе байесовских сетей

## Обзор

[`BNOverSampler`](../../api/oversampling/bn_oversampling.md) реализует подход на основе байесовских сетей для решения
проблемы дисбаланса классов путем изучения распределений признаков с помощью **смесей Гауссианов** и генерации синтетических выборок.
Этот метод улавливает сложные взаимосвязи между признаками и мультимодальные распределения, предлагая статистически строгий
ресемплинг.

## Математическая основа

### Байесовская сеть со смешанными моделями

Ресемплер использует байесовскую сеть (БС), где узлы представляют признаки, а ребра кодируют условные
зависимости. Для гибкого моделирования распределений:

1. **Непрерывные переменные** моделируются с использованием **смесей гауссовых моделей (GMM)**:

   \( P(X_i | \text{Pa}(X_i)) = \sum_{k=1}^K \pi_k \mathcal{N}(X_i | \mu_k, \Sigma_k) \)

  где:

  - $\pi_k$: веса смеси ($\sum \pi_k = 1$)
  - $\mu_k, \Sigma_k$: среднее значение и ковариация $k$-го гауссова компонента
  - $\text{Pa}(X_i)$: родительские узлы $X_i$ в БС

&nbsp;2. **Дискретные переменные** используют мультиномиальные распределения, обусловленные состояниями родительских узлов.

### Обучение параметров

Структура и параметры БС обучаются с помощью:

- **Обучение структуре**: алгоритм "восхождение к вершине" (Hill Climbing)
- **Оценка параметров**: алгоритм "ожидание-максимизация" (EM) для компонент GMM:
  \( \theta^* = \arg\max_\theta \mathbb{E}_{Z|X,\theta^{old}}[\log P(X,Z|\theta)] \)
  где $Z$ представляет скрытые назначения компонент смеси.

### Синтетическая генерация

Для миноритарного класса $C$ выборки извлекаются из условного распределения:
\( P(\mathbf{X} | C) = \prod_{i=1}^d P(X_i | \text{Pa}(X_i), C) \)
с использованием семплирования по предкам через БС, с фиксированными свидетельствами для целевого класса.

## Ключевые особенности

- **Мультимодальное моделирование**: GMM улавливают сложные распределения (например, несколько пиков в значениях признаков)
- **Условное семплирование**: генерирует выборки, учитывающие зависимости между признаками, через структуру БС
- **Гибрид дискретных и непрерывных данных**: нативно обрабатывает смешанные типы данных через:
    - Квантильную дискретизацию (предварительная обработка)
    - Семплирование с учетом типа (столбцы _disc_num_ преобразуются в целые числа после генерации)

## Преимущества перед традиционными методами

1. Сохраняет **нелинейные корреляции** между признаками
2. Избегает артефактов интерполяции (характерных для SMOTE) за счет вероятностного семплирования
3. Адаптируется к гетерогенным распределениям через компоненты смеси

## Пример

``` py title="examples/imbalanced/iris_example.py"
--8<-- "examples/imbalanced/iris_example.py"
```
